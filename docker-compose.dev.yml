services:
  api:
    build:
      context: .
      dockerfile: SAED-PortalEmpleado.Api/Dockerfile.dev
    env_file:
      - ./.env
    environment:
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT:-Development}
      DatabaseProvider: ${DatabaseProvider:-Sqlite}
      ConnectionStrings__DefaultConnection: ${ConnectionStrings__DefaultConnection:-Data Source=App_Data/portal-empleado-dev.db}
      Authentication__DevLogin__Enabled: ${Authentication__DevLogin__Enabled:-false}
      DOTNET_USE_POLLING_FILE_WATCHER: "1"
      DOTNET_WATCH_SUPPRESS_LAUNCH_BROWSER: "1"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
      SecuritySettings__Cookie__Secure: "false"
      ReciboSueldo__DataDirectory: /workspace/recibo-sueldo
    volumes:
      - ./:/workspace
      - api-data:/workspace/SAED-PortalEmpleado.Api/App_Data
    ports:
      - "5011:5011"

  frontend:
    build:
      context: .
      dockerfile: frontend/portal-empleado/Dockerfile.dev
    env_file:
      - ./.env
    environment:
      VITE_AUTH_MODE: ${VITE_AUTH_MODE:-google}
      VITE_API_PROXY_TARGET: ${VITE_API_PROXY_TARGET:-http://api:5011}
      VITE_SIGNIN_PROXY_TARGET: ${VITE_SIGNIN_PROXY_TARGET:-http://api:5011}
      CHOKIDAR_USEPOLLING: "true"
    volumes:
      - ./frontend/portal-empleado:/workspace/frontend/portal-empleado
      - frontend-node-modules:/workspace/frontend/portal-empleado/node_modules
    ports:
      - "0.0.0.0:5173:5173"
    depends_on:
      - api

volumes:
  api-data:
  frontend-node-modules:
